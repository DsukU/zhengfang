ğŸ« æ–°æ­£æ–¹æ•™åŠ¡ç®¡ç†ç³»ç»Ÿ API

ğŸ˜ å‡ ä¹è§„é¿æ‰€æœ‰å­¦æ ¡ä¸åŒå¯¼è‡´çš„å…¼å®¹æ€§é—®é¢˜ï¼Œå¯æ”¾å¿ƒé£Ÿç”¨ï¼ï¼


## åŠŸèƒ½å®ç°

- [âˆš] ç™»å½•ï¼ˆè‡ªåŠ¨è¯†åˆ«æ˜¯å¦éœ€è¦éªŒè¯ç ï¼‰
- [âˆš] ä¸ªäººä¿¡æ¯
- [âˆš] æˆç»©æŸ¥è¯¢ï¼ˆä¸¤ç§æ¥å£ï¼‰
- [âˆš] è¯¾è¡¨æŸ¥è¯¢
- [âˆš] è¯¾ç¨‹è¡¨ PDF
- [âˆš] å­¦ä¸šç”Ÿæ¶¯æ•°æ®
- [âˆš] å­¦ä¸šç”Ÿæ¶¯ï¼ˆå­¦ä¸šæˆç»©æ€»è¡¨ï¼‰ PDF ï¼ˆ**å­˜åœ¨å…¼å®¹é—®é¢˜**ï¼‰
- [âˆš] åœè¡¥æ¢è¯¾æ¶ˆæ¯
- [âˆš] æŸ¥è¯¢å·²é€‰è¯¾ç¨‹
- [âˆš] è·å–é€‰è¯¾æ¿å—è¯¾åˆ—è¡¨
- [âˆš] é€‰è¯¾
- [âˆš] é€€è¯¾
- [ ] ç©ºæ•™å®¤æŸ¥è¯¢

## çŠ¶æ€ç 

ä¸ºäº†ä¸€äº›ç‰¹æ®Šçš„ä¸šåŠ¡é€»è¾‘ï¼Œå¦‚éªŒè¯ç é”™è¯¯åè‡ªåŠ¨åˆ·æ–°é¡µé¢è·å–ç­‰ï¼Œä½¿ç”¨äº†è‡ªå®šä¹‰çŠ¶æ€ç ï¼Œè¯¦æƒ…å¦‚ä¸‹ï¼š

| çŠ¶æ€ç  | å†…å®¹                 |
| ------ | -------------------- |
| 998    | ç½‘é¡µå¼¹çª—æœªå¤„ç†å†…å®¹   |
| 999    | æ¥å£é€»è¾‘æˆ–æœªçŸ¥é”™è¯¯   |
| 1000   | è¯·æ±‚è·å–æˆåŠŸ         |
| 1001   | ï¼ˆç™»å½•ï¼‰éœ€è¦éªŒè¯ç    |
| 1002   | ç”¨æˆ·åæˆ–å¯†ç ä¸æ­£ç¡®   |
| 1003   | è¯·æ±‚è¶…æ—¶             |
| 1004   | éªŒè¯ç é”™è¯¯           |
| 1005   | å†…å®¹ä¸ºç©º             |
| 1006   | cookies å¤±æ•ˆæˆ–è¿‡æœŸ   |
| 1007   | æ¥å£å¤±æ•ˆè¯·æ›´æ–°       |
| 2333   | ç³»ç»Ÿç»´æŠ¤æˆ–æœåŠ¡è¢« ban |

## Tipsâš ï¸
- æœ¬ä¾‹ç¨‹ä½¿ç”¨äº†Flaskæ¡†æ¶è¿›è¡Œè°ƒç”¨ï¼Œå¦‚éœ€å…¶ä»–ç¯å¢ƒè¯·è‡ªè¡Œæ›´æ”¹è°ƒç”¨ã€‚
- æœ‰äº›åŠŸèƒ½å…·å¤‡äº†ä¼ å‚åŠŸèƒ½ï¼Œä¾‹å¦‚usernameï¼Œpassword è‹¥æ ¹æ®è‡ªå·±çš„å¼€å‘ç¯å¢ƒåšå‡ºæ›´æ”¹æˆ–å¢æ·»ã€‚
- è¯·å…ˆåœ¨ `config.json` ä¸­ä¿®æ”¹æ•™åŠ¡ç³»ç»Ÿ `base_url` å’Œä¸Šä¸‹è¯¾æ—¶é—´ `raspisanie` ã€‚
  - åªéœ€å¡«å†™`https://xxx.com`åˆ° base_url ä¸­ï¼Œæ‹¼æ¥åä¸ç±»ä¸­ `self.xxurl` ä¸åŒçš„è·¯å¾„éƒ¨åˆ†åœ¨ API ä»£ç å†…å¢åˆ æ”¹ã€‚
- å­¦ä¸šç”Ÿæ¶¯æ•°æ®ä¸ºæ•™åŠ¡ç³»ç»Ÿ **â€œå­¦ç”Ÿå­¦ä¸šæƒ…å†µæŸ¥è¯¢â€** é¡µé¢å†…å®¹ï¼Œè·å–æ•°æ®æ—¶è¯·ç•™æ„ `config.json` ä¸­ `ignore_type` å’Œ `detail_category_type`ã€‚
  - `ignore_type` è¡¨ç¤ºéœ€è¦å¿½ç•¥çš„æœ€é¡¶éƒ¨æ ¹ç±»å‹ï¼Œå¦‚ â€œä¸»ä¿®â€ï¼Œâ€œ20XX çº§ XX ä¸“ä¸šâ€ ç­‰æ— ç”¨ç±»å‹ï¼Œ**å¯ç•™ç©ºæ•°ç»„ï¼Œå¯¹ç»“æœæ— å½±å“**ã€‚
  - `detail_category_type` è¡¨ç¤ºéœ€è¦è¯¦ç»†è·å–è¯¾ç¨‹åˆ†ç±»çš„ç±»å‹ï¼Œå¦‚ â€œå…¶ä»–è¯¾ç¨‹â€ éœ€è·å–è¯¥ç½‘è¯¾å±äºä»€ä¹ˆç±»ç­‰ï¼Œ**å¯ç•™ç©ºæ•°ç»„**ã€‚
- æ•™åŠ¡ç³»ç»Ÿçš„ cookies åœ¨ä¸åŒå­¦æ ¡ç»Ÿä¸€è®¤è¯ç³»ç»Ÿä¸åŒï¼Œ**è‹¥ç³»ç»Ÿå¼€å¯äº†éªŒè¯ç ä¸” cookies æ ¼å¼å†…å®¹ä¸é»˜è®¤æœ‰å‡ºå…¥**ï¼Œè¯·ä¿®æ”¹ `mian.py` ä¸­ `login_with_kaptcha()` ä¸­å…¼å®¹å·®å¼‚æ³¨é‡Šéƒ¨åˆ†ã€‚
- å…¼å®¹å¯¼è‡´ å­¦ä¸šç”Ÿæ¶¯æ•°æ® PDF è¡¨çš„å¯¼å‡ºä¼šå‡ºç°é—®é¢˜ï¼Œå¾…æ’æŸ¥ã€‚
- ä¸€ä¸ªç®€å•çš„æµ‹è¯•ç¤ºä¾‹

  ```python
  import time
  import flask
  import datetime
  from mian import Client
  from flask import request
  from dateutil.relativedelta import relativedelta
  
  # å®ä¾‹åŒ–apiï¼ŒæŠŠå½“å‰è¿™ä¸ªpythonæ–‡ä»¶å½“ä½œä¸€ä¸ªæœåŠ¡ï¼Œ__name__ä»£è¡¨å½“å‰è¿™ä¸ªpythonæ–‡ä»¶
  app = flask.Flask(__name__)
  cookies = {}
  
  stu = Client(cookies=cookies)
  
  
  def CalTime(date1):
      date1 = time.strptime(date1, "%Y-%m-%d")
      date2 = datetime.datetime.now().timetuple()
  
      date1 = datetime.datetime(date1[0], date1[1], date1[2])
      date2 = datetime.datetime(date2[0], date2[1], date2[2])
      # è¿”å›ä¸¤ä¸ªå˜é‡ç›¸å·®çš„å€¼ï¼Œå°±æ˜¯ç›¸å·®å¤©æ•°
      differ = date2 - date1
      WeekTh = differ // datetime.timedelta(days=7) + 1
  
      return WeekTh
  
  
  @app.route('/Login', methods=['GET', 'POST'])  # ç”¨æˆ·ç™»å½•æ¨¡å—
  def login():
      if cookies == {}:
          lgn = stu.login(request.args.get('username'), request.args.get('password'))
          if lgn["code"] == 1002:
              return lgn
          elif lgn["code"] != 1000:
              return lgn
          elif lgn["code"] == 1000:
              return lgn
  
  
  @app.route('/Info', methods=['GET', 'POST'])  # è·å–ä¸ªäººä¿¡æ¯
  def info():
      result = stu.get_info(request.args.get('password'), request.args.get('username'))  # è·å–ä¸ªäººä¿¡æ¯
      return result
  
  
  @app.route('/ScoreDetails', methods=['GET', 'POST'])  # è·å–æˆç»©ä¿¡æ¯
  def ScoreDetails():
      result = stu.get_grade(int(request.args.get('year')), int(request.args.get('term')),
                             request.args.get('username'))  # è·å–æˆç»©ä¿¡æ¯ï¼Œè‹¥æ¥å£é”™è¯¯è¯·æ·»åŠ  use_personal_info=Trueï¼Œåªå¡«å¹´ä»½è·å–å…¨å¹´
      return result
  
  
  @app.route('/Table', methods=['GET', 'POST'])  # è·å–è¯¾ç¨‹è¡¨ä¿¡æ¯
  def Table():
      result = stu.get_schedule(int(request.args.get('year')), int(request.args.get('term')))  # è·å–è¯¾ç¨‹è¡¨ä¿¡æ¯
      return result
  
  
  @app.route('/academia', methods=['GET', 'POST'])  # è·å–å­¦ä¸šç”Ÿæ¶¯æ•°æ®
  def academia():
      result = stu.get_academia()  # è·å–å­¦ä¸šç”Ÿæ¶¯æ•°æ®
      return result
  
  
  @app.route('/courses', methods=['GET', 'POST'])  # ç”¨æˆ·ç™»å½•æ¨¡å—
  def courses():
      result = stu.get_selected_courses(int(request.args.get('year')), int(request.args.get('term')))  # è·å–å·²é€‰è¯¾ç¨‹ä¿¡æ¯
      return result
  
  
  @app.route('/GetInfo', methods=['GET', 'POST'])  # å¼€å­¦ä¿¡æ¯æ¨¡å—
  def GetInfo():
      getinfo = {}
      NowMonth = datetime.date.today().strftime("%-m")
      if NowMonth == '8' or NowMonth == '9' or NowMonth == '10' or NowMonth == '11' or NowMonth == '12' or NowMonth == '1' or NowMonth == '2':
          semester = "1"
          NowYear = datetime.date.today().strftime("%Y")
          NextYear = datetime.date.today() + relativedelta(years=1)
          SchoolYear = NowYear + "-" + NextYear.strftime('%Y')
          getinfo['SchoolYear'] = SchoolYear
          getinfo['semester'] = semester
          getinfo['teachWeek'] = CalTime("2022-8-21")
          getinfo['code'] = 1000
          return getinfo
      else:
          semester = "2"
          LastYear = datetime.date.today() - relativedelta(years=1)
          NowYear = datetime.date.today().strftime("%Y")
          SchoolYear = LastYear.strftime('%Y') + "-" + NowYear
          getinfo['SchoolYear'] = SchoolYear
          getinfo['semester'] = semester
          getinfo['teachWeek'] = CalTime("2022-8-21")
          getinfo['code'] = 1000
          return getinfo
  
  
  if __name__ == '__main__':
      app.run(port=5001, debug=True, host='127.0.0.1')

  ```
